--CRIANDO UMA VIEW
CREATE OR REPLACE VIEW V_ALUNO
AS 
  SELECT COD_ALUNO AS CODIGO, SALARIO,
    NOME AS ALUNO, CIDADE
      FROM TALUNO
        WHERE ESTADO= 'RS';
        
--USANDO A VIEW

SELECT * FROM V_ALUNO
ORDER BY ALUNO;

--CRIANDO MAIS UMA VIEW 

CREATE OR REPLACE VIEW V_CONTRATO_TOP
AS
  SELECT COD_CONTRATO, DESCONTO
  FROM TCONTRATO
  WHERE DESCONTO >= 10;
  
-- USANDO A VIEW

SELECT * FROM V_CONTRATO_TOP;

--VERIFICANDO O NOME DA VIEW

SELECT VIEW_NAME, TEXT 
  FROM USER_VIEWS;
  
-- VIEW COM PARAMETROS DE SAIDA 

CREATE OR REPLACE VIEW V_ALUNO2(COD, ALUNO, SAL)
  AS 
    SELECT COD_ALUNO, NOME, SALARIO
    FROM TALUNO;
    
-- USANDO A VIEW COM PARAMETROS DE SAIDA
    
SELECT * FROM V_ALUNO2;

-- CRAINDO VIEW COMPLEXA

CREATE OR REPLACE VIEW V_CONTRATO
AS  
  SELECT TRUNC(DATA) AS DATA,
          MAX(DESCONTO) MAXIMO,
          AVG(DESCONTO) MEDIA,
          COUNT(*) QTDE
  FROM TCONTRATO
  GROUP BY TRUNC(DATA);

-- SELECIONANDO A VIEW

SELECT * FROM V_CONTRATO;

-- CRIANDO VIEW SIMPLES

CREATE OR REPLACE VIEW V_PESSOA_F
AS
  SELECT COD_PESSOA, TIPO, NOME, COD_RUA AS RUA 
  FROM TPESSOA
  WHERE TIPO='F';

-- SELECIONANDO VIEW SIMPLES

SELECT * FROM V_PESSOA_F;

-- EXEMPLO DE CONSULTA USANDO A TABELA

SELECT PES.COD_PESSOA AS CODIGO,
        PES.NOME AS PESSOA,
        CID.NOME AS CIDADE,
        RUA.NOME AS RUA
FROM V_PESSOA_F PES, TRUA RUA, TCIDADE CID
WHERE PES.RUA = RUA.COD_RUA (+) AND
CID.COD_CIDADE = RUA.COD_CIDADE
ORDER BY PES.NOME;

-- OPERAÇÃO DE DML NA VIEW 

CREATE OR REPLACE VIEW vcursos1000ck
  AS
    SELECT COD_CURSO, NOME, VALOR
    FROM TCURSO
    WHERE VALOR = 1000
    WITH CHECK OPTION CONSTRAINT vcursos100_ck;

-- USANDO A VIEW

INSERT INTO vcursos1000ck
  (COD_CURSO, NOME, VALOR)
  VALUES (52,'TESTE Y',999);
  
INSERT INTO vcursos1000ck
  (COD_CURSO, NOME, VALOR)
  VALUES (12,'TESTE X', 1000);
  
SELECT * FROM TCURSO;

--DELETANDO EM VIEW

DELETE FROM V_ALUNO WHERE CODIGO = 3;

--INSERINDO EM VIEW 

INSERT INTO V_ALUNO
VALUES (50,500,'MARIA','NH');

SELECT * FROM V_ALUNO;

--EXEMPLO DE DML EM VIEW COMPLEXA

DELETE FROM V_CONTRATO;

--VIEW SOMENTE PARA A LEITURA

CREATE OR REPLACE VIEW V_ALUNO_3
AS
  SELECT COD_ALUNO CODIGO,
  NOME ALUNO, CIDADE
  FROM TALUNO
  WHERE ESTADO = 'RS'
  WITH READ ONLY;

--TESTE DE DELEÇÃO

DELETE FROM V_ALUNO_3;

