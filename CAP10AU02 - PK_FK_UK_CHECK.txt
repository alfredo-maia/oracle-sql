--CRIANDO TABELA TCIDADE
CREATE TABLE TCIDADE (
  cod_cidade INTEGER NOT NULL,
  nome VARCHAR2 (40),
  CONSTRAINT pk_cidade2 PRIMARY KEY (cod_cidade)
  );

--CRIANDO TABELA DE BAIRRO

CREATE TABLE TBAIRRO2 (
  cod_cidade INTEGER NOT NULL,
  cod_bairro INTEGER NOT NULL,
  nome VARCHAR2(20),
  CONSTRAINT pk_bairro2 PRIMARY KEY (cod_cidade,cod_bairro)
);

--ADICIONANDO CHAVE ESTRANGEIRA
ALTER TABLE TBAIRRO ADD CONSTRAINT fk_cod_cidade
FOREIGN KEY (cod_cidade)
REFERENCES TCIDADE(cod_cidade);

--CRIANDO TABELA DE RUA 

CREATE TABLE TRUA(
  cod_rua INTEGER NOT NULL,
  cod_cidade INTEGER NOT NULL,
  cod_bairro INTEGER,
  nome VARCHAR(40),
  CONSTRAINT pk_rua PRIMARY KEY (cod_rua)
);

--ADICIONANDO CONSTRAINT DA TRUA

ALTER TABLE TRUA ADD CONSTRAINT fk_cidadebairro
FOREIGN KEY (cod_cidade,cod_bairro)
REFERENCES tbairro(cod_cidade,cod_bairro);

--CRIANDO TABELA DE PESSOA

CREATE TABLE TPESSOA (
  cod_pessoa INTEGER NOT NULL,
  tipo VARCHAR2(1) NOT NULL,
  nome VARCHAR2(30) NOT NULL,
  pessoa VARCHAR(1) NOT NULL,
  cod_rua INTEGER NOT NULL,
  cpf VARCHAR2(15),
  CONSTRAINT pk_pessoa PRIMARY KEY(cod_pessoa)
);

--ADICINANDO UNIQUE KEY

ALTER TABLE TPESSOA ADD CONSTRAINT uk_cpf UNIQUE KEY (cpf);

--ADICIONANDO CHAVE ESTRANGEIRA

ALTER TALBE TPESSOA ADD CONSTRAINT fk_pessoa_rua FOREIGN KEY (cod_rua) 
REFERENCES TRUA(cod_rua);

--INSERINDO DADOS NA TABELA CIDADE

INSERT INTO TCIDADE VALUES(1,'NOVO HAMBURGO');
INSERT INTO TCIDADE VALUES(2,'IVOTI');
INSERT INTO TCIDADE VALUES(3,'SAPIRANGA');
INSERT INTO TCIDADE VALUES(4,'TAQUARA');

--INSERINDO DADOS NA TABELA DE BAIRRO

INSERT INTO TBAIRRO VALUES (1,1,'CENTRO');
INSERT INTO TBAIRRO VALUES (2,1,'RIO BRANCO');
INSERT INTO TBAIRRO VALUES (3,2,'CENTRO');
INSERT INTO TBAIRRO VALUES (3,1,'FRITZ');

--INSERINDO DADOS NA TABELA DE RUA

INSERT INTO TRUA VALUES (1,1,1,'MARCILIO DIAS');
INSERT INTO TRUA VALUES (2,2,1,'FRITZ');
INSERT INTO TRUA VALUES (3,3,2,'JACOBINA');
INSERT INTO TRUA VALUES (4,3,1,'JOAO DA SILVA');

--CRAINDO VERIFICAÇÃO

ALTER TABLE TPESSOA ADD CONSTRAINT ck_pessoa_tipo
CHECK (tipo IN('C','F'));

ALTER TABLE TPESSOA ADD CONSTRAINT ck_pessoa_f_j
CHECK (pessoa IN('F','J'));

--EXCLUINDO CONSTRAINT

ALTER TABLE TRUA DROP CONSTRAINT  nome_da_constraint

--INSERINDO DADOS NA TABELA DE PESSOA

INSERT INTO TPESSOA VALUES (1,'C','MARCIO','F',1,'1234');
INSERT INTO TPESSOA VALUES(2,'F','BEATRIZ','F',2,'123');
INSERT INTO TPESSOA VALUES(3,'F','PEDRO','F','4','231');
INSERT INTO TPESSOA VALUES(4,'C','MARIA','F','2','213');

--APAGANDO CONSTRAINT DE FOREIGN KEY

ALTER TABLE TPESSOA DROP CONSTRAINT NOME_DA_CONSTRAINT
CASCADE CONSTRAINT;

--VERIFICANDO FAIXA DE DESCONTO

ALTER TABLE TCONTRATO ADD CONSTRAINT ck_contrato CHECK (DESCONTO
BETWEEN 0 AND 30 );

--DESABILITANDO CONSTRAINT

ALTER TABLE TPESSOA DISABLE CONSTRAINT PK_PESSOA;

--HABILITANDO CONSTRAINT

ALTER TABLE TPESSOA ENABLE CONSTRAINT PK_PESSOA; 

--VERIFICAR CONSTRAINT USUÁRIO

SELECT * FROM USER_CONSTRAINTS WHERE TABLE_NAME = 'TPESSOA';

--CONSTRAINT E AS COLUNAS ASSOCIADAS

SELECT CONSTRAINT_NAME, COLUMN_NAME 
FROM USER_CONS_COLUMNS
WHERE TABLE_NAME = 'TPESSOA';


--VERIFICANDO OBJETOS

SELECT OBJECT_NAME, OBJECT_TYPE FROM USER_OBJECTS
WHERE OBJECT_NAME LIKE'%T%';

--VERIFICANDO TPESSOA

SELECT * FROM TPESSOA;

--COMANDOS EXTRAS
COMMIT;

SELECT * FROM ALL_CONSTRAINTS WHERE OWNER = 'ALFREDO';

INSERT INTO TCONTRATO VALUES (10,SYSDATE,2,300,NULL);

SELECT * FROM TCONTRATO;


SELECT * FROM TBAIRRO;

INSERT INTO TPESSOA VALUES (8,'C','ANA','F',1,'1234');

DELETE FROM TPESSOA WHERE COD_PESSOA = 8;

SELECT * FROM TPESSOA;

ALTER TABLE TRUA ADD CONSTRAINT pk_rua PRIMARY KEY (cod_rua);

INSERT INTO TRUA VALUES (5,1,1,'GEORGE');

SELECT * FROM TRUA;

SELECT * FROM ALL_CONSTRAINTS WHERE Upper(CONSTRAINT_NAME) LIKE '%PK_RUA';

UPDATE ALL_CONSTRAINTS SET CONSTRAINT_NAME = 'pk_rua' WHERE CONSTRAINT_NAME = 'SYS_C007095';
